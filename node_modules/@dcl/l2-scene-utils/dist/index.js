define("@dcl/l2-scene-utils",["exports","@decentraland/EthereumController","eth-connect","@decentraland/web3-provider","@dcl/ecs-scene-utils"],(function(e,t,n,a,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function s(e,t,n,a){return new(n||(n=Promise))((function(i,s){function r(e){try{o(a.next(e))}catch(e){s(e)}}function u(e){try{o(a.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,u)}o((a=a.apply(e,t||[])).next())}))}function r(e,t){var n,a,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&s[0]?a.return:s[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,s[1])).done)return i;switch(a=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,a=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],a=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}var u=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"tokenType",type:"bytes32"},{indexed:!0,internalType:"address",name:"predicateAddress",type:"address"}],name:"PredicateRegistered",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousAdminRole",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"newAdminRole",type:"bytes32"}],name:"RoleAdminChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleGranted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleRevoked",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"rootToken",type:"address"},{indexed:!0,internalType:"address",name:"childToken",type:"address"},{indexed:!0,internalType:"bytes32",name:"tokenType",type:"bytes32"}],name:"TokenMapped",type:"event"},{inputs:[],name:"DEFAULT_ADMIN_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"DEPOSIT",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"ETHER_ADDRESS",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"MAPPER_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"MAP_TOKEN",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"childChainManagerAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"childToRootToken",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"}],name:"getRoleAdmin",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"uint256",name:"index",type:"uint256"}],name:"getRoleMember",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"}],name:"getRoleMemberCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"grantRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"hasRole",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"processedExits",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"renounceRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"revokeRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"rootToChildToken",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"tokenToType",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"typeToPredicate",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"},{inputs:[{internalType:"address",name:"_owner",type:"address"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newStateSender",type:"address"}],name:"setStateSender",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"stateSenderAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newCheckpointManager",type:"address"}],name:"setCheckpointManager",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"checkpointManagerAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newChildChainManager",type:"address"}],name:"setChildChainManagerAddress",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"tokenType",type:"bytes32"},{internalType:"address",name:"predicateAddress",type:"address"}],name:"registerPredicate",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"rootToken",type:"address"},{internalType:"address",name:"childToken",type:"address"},{internalType:"bytes32",name:"tokenType",type:"bytes32"}],name:"mapToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"depositEtherFor",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"address",name:"rootToken",type:"address"},{internalType:"bytes",name:"depositData",type:"bytes"}],name:"depositFor",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"inputData",type:"bytes"}],name:"exit",outputs:[],stateMutability:"nonpayable",type:"function"}];function o(e){return new Promise((function(t,n){var a=new Entity;engine.addEntity(a),a.addComponent(new i.Delay(e,(function(){t(),engine.removeEntity(a)})))}))}function p(e,t){void 0===t&&(t=!1);var n=e.length;if(n>=64)return e;if(n%2!=0&&(e="0"+e),n<64)for(;e.length<64;)t?e+="0":e="0"+e;return e}var y=[{inputs:[{internalType:"string",name:"name_",type:"string"},{internalType:"string",name:"symbol_",type:"string"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"userAddress",type:"address"},{indexed:!1,internalType:"address payable",name:"relayerAddress",type:"address"},{indexed:!1,internalType:"bytes",name:"functionSignature",type:"bytes"}],name:"MetaTransactionExecuted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"CHILD_CHAIN_ID",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"CHILD_CHAIN_ID_BYTES",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[],name:"ERC712_VERSION",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"ROOT_CHAIN_ID",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"ROOT_CHAIN_ID_BYTES",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"subtractedValue",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"userAddress",type:"address"},{internalType:"bytes",name:"functionSignature",type:"bytes"},{internalType:"bytes32",name:"sigR",type:"bytes32"},{internalType:"bytes32",name:"sigS",type:"bytes32"},{internalType:"uint8",name:"sigV",type:"uint8"}],name:"executeMetaTransaction",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getNonce",outputs:[{internalType:"uint256",name:"nonce",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"addedValue",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"}],name:"mint",outputs:[],stateMutability:"nonpayable",type:"function"}],d={mainnet:{l1Token:"0x0f5d2fb29fb7d3cfee444a200298f468908cc942",l2Token:"0xA1c57f48F0Deb89f569dFbE6E2B7f46D33606fD4",ERC20Predicate:"0x40ec5B33f54e0E8A33A975908C5BA1c14e5BbbDf",RootChainManager:"0xA0c68C638235ee32657e8f720a23ceC1bFc77C77"},goerli:{l1Token:"0xe7fDae84ACaba2A5Ba817B6E6D8A2d415DBFEdbe",l2Token:"0x882Da5967c435eA5cC6b09150d55E8304B838f45",ERC20Predicate:"0xdD6596F2029e6233DEFfaCa316e6A95217d4Dc34",RootChainManager:"0xBbD7cBFA79faee899Eaf900F13C9065bF03B1A74"}};function l(e){var t={name:"mainnet"==e?"(PoS) Decentraland MANA":"Dummy ERC20",version:"1",verifyingContract:d[e].l2Token},n=[{name:"name",type:"string"},{name:"version",type:"string"}];return"mainnet"==e?(t.salt="0x"+function(e,t,n){void 0===n&&(n=" ");if(e.length>=t)return String(e);var a=t-e.length,i=Math.ceil(a/n.length);for(;i>>=1;)n+=n,1===i&&(n+=n);return n.slice(0,a)+e}(137..toString(16),64,"0"),n.push({name:"verifyingContract",type:"address"},{name:"salt",type:"bytes32"})):(t.chainId=5,n.push({name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"})),[t,n]}function c(e,t){return s(this,void 0,void 0,(function(){var i;return r(this,(function(s){switch(s.label){case 0:return t?[3,2]:[4,a.getProvider()];case 1:i=s.sent(),t=new n.RequestManager(i),s.label=2;case 2:return[4,new n.ContractFactory(t,y).at(e)];case 3:return[2,{contract:s.sent(),requestManager:t}]}}))}))}var m=Object.freeze({__proto__:null,getDomainData:l,getContract:c,balance:function(e,a){return void 0===a&&(a="mainnet"),s(this,void 0,void 0,(function(){var i,u,o=this;return r(this,(function(p){switch(p.label){case 0:return(u=e)?[3,2]:[4,t.getUserAccount()];case 1:u=p.sent(),p.label=2;case 2:return i=u,[2,Promise.all([c(d[a].l1Token).then((function(e){var t=e.contract;return s(o,void 0,void 0,(function(){var e;return r(this,(function(a){switch(a.label){case 0:return[4,t.balanceOf(i)];case 1:return e=a.sent(),[2,+n.fromWei(e.toString(),"ether")]}}))}))})),c(d[a].l2Token,new n.RequestManager("mainnet"==a?new n.WebSocketProvider("wss://ws-mainnet.matic.network"):new n.WebSocketProvider("wss://ws-mumbai.matic.today"))).then((function(e){var t=e.contract;return s(o,void 0,void 0,(function(){var e;return r(this,(function(a){switch(a.label){case 0:return[4,t.balanceOf(i)];case 1:return e=a.sent(),[2,+n.fromWei(e.toString(),"ether")]}}))}))}))]).then((function(e){return{l1:e[0],l2:e[1]}}))]}}))}))},depositMana:function(e,a){return void 0===a&&(a="mainnet"),s(this,void 0,void 0,(function(){var i,s,y,l,m,b,f,T,v,h,g,w;return r(this,(function(r){switch(r.label){case 0:return[4,t.getUserAccount()];case 1:return i=r.sent(),[4,c(d[a].l1Token)];case 2:return s=r.sent(),y=s.contract,l=s.requestManager,[4,y.balanceOf(i)];case 3:return m=r.sent(),+n.fromWei(m.toString(),"ether")<e?[2,"Balance too low"]:[4,y.allowance(i,d[a].ERC20Predicate)];case 4:return+(b=r.sent())<+n.toWei(e,"ether")?0!=+b?[3,10]:[4,y.approve(d[a].ERC20Predicate,+n.toWei(e,"ether"),{from:i})]:[3,20];case 5:f=r.sent(),T=null,r.label=6;case 6:return null!=T?[3,9]:[4,o(2e3)];case 7:return r.sent(),[4,null==l?void 0:l.eth_getTransactionReceipt(f.toString())];case 8:return T=r.sent(),[3,6];case 9:return[3,20];case 10:return[4,y.approve(d[a].ERC20Predicate,0,{from:i})];case 11:v=r.sent(),h=null,r.label=12;case 12:return null!=h?[3,15]:[4,o(1e3)];case 13:return r.sent(),[4,null==l?void 0:l.eth_getTransactionReceipt(v.toString())];case 14:return h=r.sent(),[3,12];case 15:return[4,y.approve(d[a].ERC20Predicate,+n.toWei(e,"ether"),{from:i})];case 16:g=r.sent(),w=null,r.label=17;case 17:return null!=w?[3,20]:[4,o(1e3)];case 18:return r.sent(),[4,null==l?void 0:l.eth_getTransactionReceipt(g.toString())];case 19:return w=r.sent(),[3,17];case 20:return[4,new n.ContractFactory(l,u).at(d[a].RootChainManager)];case 21:return[4,r.sent().depositFor(i,d[a].l1Token,"0x"+p((+n.toWei(e,"ether")).toString(16),!1),{from:i})];case 22:return r.sent(),[2]}}))}))},sendMana:function(e,i,u){return void 0===u&&(u="mainnet"),s(this,void 0,void 0,(function(){var y=this;return r(this,(function(m){return[2,new Promise((function(m,b){return s(y,void 0,void 0,(function(){var y,f,T,v=this;return r(this,(function(h){switch(h.label){case 0:return[4,t.getUserAccount()];case 1:return y=h.sent(),[4,a.getProvider()];case 2:return f=h.sent(),T=new n.RequestManager(f),[4,c(d[u].l2Token,new n.RequestManager("mainnet"==u?new n.WebSocketProvider("wss://ws-mainnet.matic.network"):new n.WebSocketProvider("wss://ws-mumbai.matic.today"))).then((function(t){var a=t.contract,d=t.requestManager;return s(v,void 0,void 0,(function(){var t,c,f,v,h,g,w,M,x,A=this;return r(this,(function(C){switch(C.label){case 0:return[4,a.balanceOf(y)];case 1:return t=C.sent(),+n.fromWei(t.toString(),"ether")<i?[2,"balance too low"]:(c=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,i,s=n.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(a=s.next()).done;)r.push(a.value)}catch(e){i={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return r}(l(u),2),f=c[0],v=c[1],h=[{name:"nonce",type:"uint256"},{name:"from",type:"address"},{name:"functionSignature",type:"bytes"}],g="0xa9059cbb000000000000000000000000"+e.toLowerCase().replace("0x","")+p((+n.toWei(i,"ether")).toString(16),!1),[4,a.getNonce(y)]);case 2:return w=C.sent(),M={nonce:w,from:y,functionSignature:g},x=JSON.stringify({types:{EIP712Domain:v,MetaTransaction:h},domain:f,primaryType:"MetaTransaction",message:M}),T.provider.sendAsync({method:"eth_signTypedData_v4",params:[y,x],jsonrpc:"2.0",id:999999999999},(function(e,t){return s(A,void 0,void 0,(function(){var n,a,i,p,l=this;return r(this,(function(c){switch(c.label){case 0:return e?(b(e),[2,error(e)]):(n=t.result.substring(2),a="0x"+n.substring(0,64),i="0x"+n.substring(64,128),p="0x"+n.substring(128,130),[4,fetch("https://l2.dcl.guru/",{headers:{"content-type":"application/json"},body:JSON.stringify({mainnet:"mainnet"==u,userAddress:y,params:[y,g,a,i,p]}),method:"POST"}).then((function(e){return e.json()})).then((function(e){return s(l,void 0,void 0,(function(){var t,n;return r(this,(function(a){switch(a.label){case 0:t=e.txHash,n=null,a.label=1;case 1:return null!=n?[3,4]:[4,o(500)];case 2:return a.sent(),[4,null==d?void 0:d.eth_getTransactionReceipt(t.toString())];case 3:return n=a.sent(),[3,1];case 4:return m({receipt:n,txId:t}),[2]}}))}))})).catch((function(e){b(e)}))]);case 1:return c.sent(),[2]}}))}))})),[2]}}))}))}))];case 3:return h.sent(),[2]}}))}))}))]}))}))}});e.matic=m,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
